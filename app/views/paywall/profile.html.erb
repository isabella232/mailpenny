<% provide(:twitter, { %>
  <% card: 'summary', %>
  <% site: '@mailman_hq', %>
  <% title: "#{@user.profile.first_name} #{@user.profile.last_name} | The Mailman", %>
  <% description: "Send #{@user.profile.first_name} a 140 character SMS to their Phone or a full Email to their Inbox.", %>
  <% image: gravatar_for(@user, { size: 150 } ) %>
<% }) %>
<div class="container profile-container">
  <div class="row">
    <div class="col-md-4 user-profile-col">
      <div class="user-profile">
        <%if(@current === true)%>
        <div style="margin-top:-25%;">
        <button class="btn btn-default" data-toggle="modal" data-target="#pass" style="border-radius: 3px;width: 100px;background-color: #2E2F30;color: white;display: inline;">Password</button>
              <button class="btn btn-default" data-toggle="modal" data-target="#myModal" style="border-radius: 3px;width: 100px;background-color: #2E2F30;color: white;display: inline;">Edit</button></div><br><br>
        <%end%>
        <div class="user-picture" style="background: url('<%= gravatar_for @user %>')"></div>
        <div class="user-name">
          <p>
            <%=@user.profile.first_name.to_s+" "+@user.profile.last_name.to_s%>
          </p>

        </div>

        <div class="user-biography">

          <p>
            <%if(@user.profile.about.nil?)%>
            <%="Edit info about you."%>
            <%else%>
            <%=@user.profile.about %>
            <%end%>
          </p>
        </div>
        <div class="user-location">
          <p>
            <%=@user.profile.location%>
          </p>
        </div>
      </div>
    </div>
    <div class="col-md-8">
      <div class="row">
        <div class="user-contact-info">
          <div class="user-profile-link">
            <h2>
              themailman.io/<%=@user.username%>
            </h2>
                      </div>
        </div>
        <div class="row">
          <div class="col-sm-6">
            <a href="#" data-toggle="modal" data-target="#emailComposeModal" class="no-link-decoration">
              <div class="user-action-button user-email-button">
                <p>
                  <i class="fa fa-envelope fa-5x"></i>
                  <br>
                  <span class="action">Send an email</span><br>
                  <span class="price">$<%=@user.reward.email %></span>
                </p>
              </div>
            </a>
          </div>
          <div class="col-sm-6">
            <a href="#" data-toggle="modal" data-target="#textComposeModal" class="no-link-decoration">
              <div class="user-action-button user-text-button no-">
                <i class="fa fa-mobile fa-5x"></i>
                <br>
                <span class="action">Send a text</span><br>
                <span class="price">$<%=@user.reward.sms %></span>
              </div>
            </a>
          </div>

        </div>
        <div>
          <%if !@user1.nil? %>
              <div class="Add balance" style="margin-left:20%;margin-top:10%;">
                <p>Your balance : <%=@user1.account.balance.to_f%><p>
          <script src="https://checkout.stripe.com/checkout.js"></script>

          <%[5,10,20,50].map{|x| x*100}.each do |amount|%>

          <button id="btn-payment-<%= amount %>" style="width:100px" class="btn btn-default">Add
            <%= amount / 100 %></button>
            <% end %>
        </div>
        <script type="text/javascript">
          var thisUser =  {
            id: "<%= @user1.id %>",
            email: "<%= @user1.email %>"
        };
          var stripeKey = "<%= Rails.configuration.stripe[:publishable_key] %>"
        </script><br>
              <div class="col-sm-7" style="margin-left: 18%;">
                <div class="settings-proof">
                  <table class="table">
                    <thead>
                    <tr >
                      <th>Service</th>
                      <th>Verify</th>
                      <th>Username</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td id="twit">
                        Twitter.com
                      </td>
                      <td>
                        <% if(@user.social_medium.twitter.to_s!="") %>
                            <p>Verified</p>
                        <% else %>
                            <button class="btn btn-default" data-toggle="modal" data-target="#twitter_verify">Verify</button>
                        <%end %>
                      </td>
                      <td>
                        <% if(@user.social_medium.present?) %>
                            <%= @user.social_medium.twitter.to_s%>
                        <% end %>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
      <%end%>
            </div>


        <div class="row">
          <div class="col-sm-10 col-sm-offset-1">
            <!--  <div class="donate-statement"><h3><%=@user.profile.first_name.to_s%> donates all proceeds to&#58;</h3></div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Model Content -->
<div class="modal fade" id="myModal" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Profile</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <p id="notif1"></p>
          <%= form_tag("/change_prof", method: 'post', remote: true, style:'margin-left:10%;') do %>
          <div>
            <label style="display: inline;">First Name:</label>
            <input required="true" value="<%=@user.profile.first_name %>" class="form-control" style="width: 250px;display: inline;border-radius: 3px;" name="fname">
            <label style=" margin-left:2%;">Last Name:</label>
            <input required="true" value="<%=@user.profile.last_name %>" class="form-control" style="width: 250px;display:inline;border-radius: 3px;" name="lname">
          </div>
          <br>
          <div>
            <label>Location:</label>
            <input required="true" value="<%=@user.profile.location %>" class="form-control" style="width: 250px;display:inline;margin-left: 1.5%;border-radius: 3px;" name="loc">
          </div>
          <br>
          <div>
            <% if (@user.phones.first == nil) %>
                <label>Country Code:</label>
                <input required="true" value="" class="form-control" style="width: 250px;display:inline;margin-left: 1.5%;border-radius: 3px;" name="cc">
                <label>Phone:</label>
                <input required="true" value="" class="form-control" style="width: 250px;display:inline;margin-left: 1.5%;border-radius: 3px;" name="phone">
            <% else %>
                <label>Country Code:</label>
                <input required="true" value="<%= @user.phones.first.country %>" class="form-control" style="width: 250px;display:inline;margin-left: 1.5%;border-radius: 3px;" name="cc">
                <label>Phone:</label>
                <input required="true" value="<%= @user.phones.first.number %>" class="form-control" style="width: 250px;display:inline;margin-left: 1.5%;border-radius: 3px;" name="phone">
            <% end %>
          </div>
          <br>
          <div>
            <label>About:</label>
            <textarea maxlength="250" class="form-control" style="width: 250px;display:inline;margin-left: 3%;border-radius: 3px;" name="about"><%=@user.profile.about %></textarea>
          </div>
          <br>
          <label >Rewards</label>
          <br>
          <div>
            <label style="display: inline">Email:</label>
            <input required="true" type="number" min="0" step="0.01" value="<%=@user.reward.email %>" class="form-control" style="width: 250px;display: inline;border-radius: 3px; margin-left: 3%;" name="remail">
            <label style=" margin-left:2.5%;">SMS:</label>
            <input required="true" type="number" min="0" step="0.01" value="<%=@user.reward.sms %>" class="form-control" style="width: 250px;display:inline;border-radius: 3px;margin-left: 5%;" name="rsms">
          </div>
          <!-- <br>
            <div>
              <label>Username:</label>
              <input required="true" class="form-control" style="width: 250px;display:inline;border-radius: 3px;" name="username">
            </div> -->
          <br>
          <div>
            <label>Password:</label>
            <input required="true" id="password_prof" class="form-control" type="password" style="width: 250px;display:inline;border-radius: 3px;" name="password">
          </div>
          <div>
            <button type="submit" class="btn btn-success" style="margin-left: 85%;width: 10%;border-radius: 3px;">Save</button>
          </div>
          <% end %>
          <div></div>

        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="pass" role="dialog">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Profile</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <p id="notif"></p>
          <%= form_tag("/change_pass", method: 'post', remote: true, style:'margin-left:10%;' ) do %>
          <br>
          <div>
            <label>Old Password:</label>
            <input required="true" id="old_password" class="form-control" type="password" style="width: 150px;display:inline;border-radius: 3px;" name="old_password">
          </div>
          <br>
          <div>
            <label>Password:</label>
            <input required="true" id="password" class="form-control" type="password" style="width: 150px;display:inline;border-radius: 3px;" name="password">
          </div>
          <br>
          <div>
            <label>Re-Type:</label>
            <input required="true" id="confirm_password" class="form-control" type="password" style="width: 150px;display:inline;border-radius: 3px;margin-left: 3.5%;" name="confirm_password">
          </div>
          <br>
          <div>
            <button type="submit" class="btn btn-success" style="margin-left: 65%;border-radius: 3px;">Save</button>
          </div>
          <% end %>
          <!--     <form method="post" action="change_pass" style="margin-left: 10%; " remote='true'>

          </form> -->
          <div></div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Email Compose Modal -->
<div class="modal fade" id="emailComposeModal" tabindex="-1" role="dialog" aria-labelledby="emailModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="emailModalLabel">Write an Email</h4>
        <p id="notif2"></p>
      </div>
      <div class="mdal-body">
        <% if @user1 %>
        <%= form_tag '/send_email_profile', method: :post,remote: 'true', class: "form" do %>
        <%= text_field_tag(
              :subject,
              params[:subject],
              placeholder: "Subject",
              class: "fom-control",
              :maxlength => 50
          ) %>
        <%= text_area_tag(
              :message,
              params[:message],
              placeholder: "Message",
              class: "form-control"
          ) %>
        <%= hidden_field_tag :username,@user.username %>
        <%=submit_tag "Send" , class:"btn btn-default" %>
        <% end %>
        <% else %>
          <p>
            Whoops! You're not logged in.
            <br>
            <%= link_to "Login", new_human_session_path, class: "btn btn-primary" %>
            <%= link_to "Register", register_path, class: "btn btn-primary" %>
          </p>
          <% end %>
      </div>
    <!--  <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary">Send</button>
      </div> -->
    </div>
  </div>
</div>
<!--END Email Compose Modal -->
<!-- Text Compose Modal -->
<div class="modal fade" id="textComposeModal" tabindex="-1" role="dialog" aria-labelledby="textModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="textModalLabel">Write a Text</h4>
        <p id="notif3"></p>
      </div>
      <div class="modal-body">

        <% if @user1 %>
        <%= form_tag '/send_sms_profile', method: :post,remote: 'true' , class: "form" do %>
        <%= text_area_tag(
              :message,
              params[:message],
              placeholder: "Message",
              class: "form-control",
              :maxlength => 140
          ) %>
        <%= hidden_field_tag :username,@user.username %>
        <%=submit_tag "Send" , class:'btn btn-default' %>
        <% end %>
      <% else %>
        <p>
          Whoops! You're not logged in.
          <br>
          <%= link_to "Login", new_human_session_path, class: "btn btn-primary" %>
          <%= link_to "Register", register_path, class: "btn btn-primary" %>
        </p>
        <% end %>
      </div>
     <!-- <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary">Send</button>
      </div> -->
    </div>
  </div>
</div>
<!--END Text Compose Modal -->
<script>
  var password = document.getElementById("password");
  var confirm_password = document.getElementById("confirm_password");

  function validatePassword() {
    if (password.value != confirm_password.value) {
      confirm_password.setCustomValidity("Passwords Don't Match");
    } else {
      confirm_password.setCustomValidity('');
    }
  }
  password.onchange = validatePassword;
  confirm_password.onkeyup = validatePassword;
</script>
<div id="twitter_verify" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Verify Twitter</h4>
      </div>
      <div class="modal-body">
        <h3>First Step:</h3>
        <a href="https://twitter.com/intent/tweet?text=Got something to say? Text it to me in 140 characters at <%= profile_link @user  %> via @TheMailmanHQ #TheMailman">Tweet about your new profile</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
        </script>
        <h3>Second Step:</h3>
        <p>Enter your twitter username</p>
        <form action="/tweet">
          <input type="text" name="user" class="form-control" placeholder="@username" style="width:250px;" />
          <input type="submit" value="Verify" class="btn btn-success" />
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>