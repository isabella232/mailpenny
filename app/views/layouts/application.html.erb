<!DOCTYPE html>
<html lang="en">
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  Hey there, you're quite an explorer
  aren't you?

  Well, there's not much to see around
  here.

  But there's never really much anywhere,
  is there?

  It's just you, me, a little HTML,
  and the clock that reads 5:10 AM

  I'm bored, and hungry, don't mind me.
  Listening to waleed dream softly in the bunk under me.

  Until next time, ciao.

  gilani ->   | o->~< |   |  |  |
              -~~~~~~~-   | o|o | <- closet
  waleed ->   | o->~< |   |  |  |

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <%# The code below is horrible, but is necessary. TODO write a helper %>

  <% if yield(:twitter) %>
  <% twitter_tags = String.new yield(:twitter)%>
  <% twitter_tags = eval ( CGI.unescapeHTML( twitter_tags ) ) %>

  <% twitter_tags.each do |key, value|%>
    <%= tag(:meta, name: "twitter:#{key}", content: (value) )%>
  <% end %>
  <% end %>
  <%# END UGLY CHUNK OF DISGUSTING CODE %>

  <link rel="icon" href="../../favicon.ico">

  <title>The Mailman | Get Paid To Read Your Mail</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Yeti by Boostwatch -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/yeti/bootstrap.min.css" integrity="sha384-yxFy3Tt84CcGRj9UI7RA25hoUMpUPoFzcdPtK3hBdNgEGnh9FdKgMVM+lbAZTKN2" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <!-- Styles for the pages -->
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>

  <!-- CSRF, obviously -->
  <%= csrf_meta_tags %>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <%= render 'layouts/shim' %>
</head>

<body>
  <!-- BEGIN HEADER (the little voice in my head screams when I type in ALL CAPS -gilani) -->
  <%= render 'layouts/header' %>
  <!-- END HEADER -->

  <!-- BEGIN BODY -->
      <%= yield %>
  <!-- END BODY -->

  <!-- BEGIN FOOTER -->
  <%= render 'layouts/footer' %>
  <!-- END FOOTER -->

  <!-- JQuery because it's always nice to have -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript for Bootstrap -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <!-- AngularJS -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
  <!-- Javascript for the application -->
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74822546-1', 'auto');
  ga('send', 'pageview');

</script>

<%[5,10,20,50].map{|x| x * 100}.each unless @current_user.nil? do |amount|%>
<script>
var handler<%= amount %> = StripeCheckout.configure({
  key: '<%= Rails.configuration.stripe[:publishable_key] %>',
  image: '/img/logo/icon-black-transparent.png',
  locale: 'auto',
  token: function (token) {
    $.post('/charges', {
      stripeToken: token.id,
      amount: <%= amount %>,
      user: <%= @current_user.id %>
    });
    console.log("<%= amount %>")
    }
});

$('#btn-payment-<%= amount %>')
  .on('click', function (e) {
    // Open Checkout with further options
    handler<%= amount %>.open({
      name: 'Mailman',
      description: "Top-up",
      amount: <%= amount %>,
      label: "Add $<%=amount / 100 %>",
      panelLabel: "Pay {{amount}}",
      bitcoin: "true",
      alipay: "true",
      email: "<%= @current_user.email %>",
      allowRememberMe: "true",
      alipayReusable: "true",
      locale: "auto"
    });
    e.preventDefault();
  });

// Close Checkout on page navigation
$(window)
  .on('popstate', function () {
    handler<%= amount %>.close();
  });

</script>

<% end %>
</body >

</html>
